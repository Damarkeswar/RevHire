package com.revhire.service;

import java.util.List;

import com.revhire.dao.ApplicationDao;
import com.revhire.dao.ApplicationDaoImpl;
import com.revhire.dao.ResumeDao;
import com.revhire.dao.ResumeDaoImpl;
import com.revhire.model.Application;

public class ApplicationServiceImpl implements ApplicationService {

	private ApplicationDao applicationDao = new ApplicationDaoImpl();

	@Override
	public boolean applyForJob(Application application) {

	    ResumeDao resumeDao = new ResumeDaoImpl();

	    int resumeId =
	        resumeDao.getLatestResumeId(application.getJobSeekerId());

	    if (resumeId == 0) {
	        System.out.println("❌ No resume found. Please create a resume first.");
	        return false;
	    }

	    application.setResumeId(resumeId);
	    NotificationService ns = new NotificationServiceImpl();
	    ns.notifyJobSeeker(
	        application.getJobSeekerId(),
	        "You have successfully applied for Job ID: " + application.getJobId()
	    );


	    return applicationDao.applyJob(application);
	}


	@Override
	public List<Application> viewMyApplications(int jobSeekerId) {
		return applicationDao.getApplicationsByJobSeeker(jobSeekerId);
	}

	@Override
	public boolean changeStatus(int applicationId, String status, String comment) {
		return applicationDao.updateApplicationStatus(applicationId, status, comment);
	}
	@Override
	public boolean withdraw(int applicationId, String reason) {

	    if (applicationId <= 0) {
	        System.out.println("❌ Invalid application ID");
	        return false;
	    }

	    if (reason == null || reason.isEmpty()) {
	        reason = "Withdrawn by candidate";
	    }
	    NotificationService ns = new NotificationServiceImpl();
	    ns.notifyJobSeeker(
	        jobSeekerId,
	        "Your application (ID: " + applicationId +
	        ") status changed to " + status
	    );

	    return applicationDao.withdrawApplication(applicationId, reason);
	}

}
