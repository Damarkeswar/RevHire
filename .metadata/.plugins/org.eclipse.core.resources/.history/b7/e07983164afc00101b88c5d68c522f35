package com.revhire.ui;

import java.util.List;
import java.util.Scanner;

import com.revhire.model.Application;
import com.revhire.service.ApplicationService;
import com.revhire.service.ApplicationServiceImpl;

public class ApplicationMenu {

	private static ApplicationService appService = new ApplicationServiceImpl();

	public static void showJobSeekerMenu(int jobSeekerId) {

		Scanner sc = new Scanner(System.in);

		while (true) {
			System.out.println("\n=== Application Menu ===");
			System.out.println("1. Apply for Job");
			System.out.println("2. View My Applications");
			System.out.println("3. Back");

			int choice = sc.nextInt();

			switch (choice) {

			case 1:
				Application app = new Application();

				System.out.print("Enter Job ID: ");
				app.setJobId(sc.nextInt());

				app.setJobSeekerId(jobSeekerId);

				if (appService.applyForJob(app)) {
					System.out.println("✅ Job applied successfully");
				} else {
					System.out.println("❌ Application failed");
				}
				break;

			case 2:
				List<Application> apps = appService.viewMyApplications(jobSeekerId);

				System.out.println("\n--- My Applications ---");
				for (Application a : apps) {
					System.out.println(
							a.getApplicationId() + " | Job ID: " + a.getJobId() + " | Status: " + a.getStatus());
				}
				break;

			case 3:
				return;
			}
		}
	}
	public static void withdraw(int jobSeekerId) {

	    Scanner sc = new Scanner(System.in);

	    // Step 1: Show applications
	    List<Application> apps =
	        appService.viewMyApplications(jobSeekerId);

	    if (apps.isEmpty()) {
	        System.out.println("❌ No applications to withdraw");
	        return;
	    }

	    System.out.println("\n--- My Applications ---");
	    for (Application a : apps) {
	        System.out.println(
	            a.getApplicationId() +
	            " | Job ID: " + a.getJobId() +
	            " | Status: " + a.getStatus()
	        );
	    }

	    // Step 2: Choose application
	    System.out.print("\nEnter Application ID to withdraw: ");
	    int appId = sc.nextInt();
	    sc.nextLine();

	    // Step 3: Confirmation
	    System.out.print("Are you sure? (Y/N): ");
	    String confirm = sc.nextLine();

	    if (!confirm.equalsIgnoreCase("Y")) {
	        System.out.println("❌ Withdrawal cancelled");
	        return;
	    }

	    // Step 4: Optional reason
	    System.out.print("Reason (optional): ");
	    String reason = sc.nextLine();

	    // Step 5: Withdraw
	    if (appService.withdraw(appId, reason)) {
	        System.out.println("✅ Application withdrawn successfully");
	    } else {
	        System.out.println("❌ Withdrawal failed");
	    }
	}

}
