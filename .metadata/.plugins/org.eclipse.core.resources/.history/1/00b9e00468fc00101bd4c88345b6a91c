package com.revhire.ui;

import java.util.Scanner;

import com.revhire.dao.EmployerDao;
import com.revhire.dao.EmployerDaoImpl;
import com.revhire.dao.JobSeekerDao;
import com.revhire.dao.JobSeekerDaoImpl;
import com.revhire.model.User;
import com.revhire.service.AuthService;
import com.revhire.service.AuthServiceImpl;

public class MainMenu {

	public static void main(String[] args) {

		Scanner sc = new Scanner(System.in);
		AuthService authService = new AuthServiceImpl();

		while (true) {
			System.out.println("\n=== RevHire ===");
			System.out.println("1. Register");
			System.out.println("2. Login");
			System.out.println("3. Exit");
			System.out.print("Enter your choice (1-3): ");

			String input = sc.nextLine();
			int choice;

			try {
				choice = Integer.parseInt(input);
			} catch (NumberFormatException e) {
				System.out.println("‚ùå Invalid input. Please enter a number.");
				continue;
			}

			switch (choice) {

			case 1:
				User user = new User();

				System.out.print("Enter Email: ");
				user.setEmail(sc.nextLine());

				System.out.print("Enter Password: ");
				user.setPassword(sc.nextLine());

				System.out.print("Enter Role (JOB_SEEKER / EMPLOYER): ");
				user.setRole(sc.nextLine());

				if (authService.register(user)) {
					System.out.println("‚úÖ Registration successful");
				} else {
					System.out.println("‚ùå Registration failed");
				}
				break;

			case 2:
			    System.out.print("Enter Email: ");
			    String email = sc.nextLine();

			    System.out.print("Enter Password: ");
			    String pass = sc.nextLine();

			    User loggedIn = authService.login(email, pass);

			    if (loggedIn == null) {
			        System.out.println("‚ùå Invalid credentials");
			        break;
			    }

			    System.out.println("‚úÖ Login successful");

			    if ("JOB_SEEKER".equalsIgnoreCase(loggedIn.getRole())) {

			        JobSeekerDao jsDao = new JobSeekerDaoImpl();
			        int jsId = jsDao.getJobSeekerIdByUserId(loggedIn.getUserId());

			        if (jsId == 0) {
			            System.out.println("‚ùå Job seeker profile not found.");
			            System.out.println("Please contact admin or re-register.");
			            break;
			        }

			        JobSeekerDashboard.show(jsId);

			    } else if ("EMPLOYER".equalsIgnoreCase(loggedIn.getRole())) {

			        // 1. Create CompanyDao
			        CompanyDao companyDao = new CompanyDaoImpl();

			        // 2. Fetch company using employer_id (= user_id)
			        Company company =
			            companyDao.getCompanyByEmployerId(loggedIn.getUserId());

			        // 3. Safety check
			        if (company == null) {
			            System.out.println("‚ùå Company not found for this employer");
			            System.out.println("Please register again.");
			            break;
			        }

			        // 4. Pass company_id to dashboard
			        EmployerDashboard.show(company.getCompanyId());
			    }


			    break;

			case 3:
				System.out.println("üëã Thank you for using RevHire");
				sc.close();
				System.exit(0);
				break;

			default:
				System.out.println("‚ùå Please enter a valid choice (1-3)");
			}
		}
	}
}
